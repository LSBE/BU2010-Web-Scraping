(function(){'use strict';if(!window.Meanbee){window.Meanbee={};}
var colourSwatchClickedEvent='penheven_journal_colour_handler:colour_swatch_clicked';var JournalColourHandler={initialize:function(options){var self=this;self.options=Object.extend({defaultColourSelectElement:false,colourSwatches:$$('.product-colour-option-item'),mainImages:$$('[data-mainImage]'),galleries:$$('.product-image-thumbnails ul')},options||{});if(!self.options.defaultColourSelectElement){throw'defaultColourSelectElement is not provided to JournalColorHandler. Unable to initialise.';}
self.defaultColourSelectElement=self.options.defaultColourSelectElement;self.colourSwatches=self.options.colourSwatches;self.mainImages=self.options.mainImages;self.defaultColourSelectElement.up(1).style.display='none';self.defaultColourSelectElement.up(1).previous('label').style.display='none';self.defaultColourSelectElement.up(2).style.display='none';self.colourSwatches.each(function(colourSwatch){colourSwatch.observe('click',function(){self.selectColourSwatch(colourSwatch);var data=self.extractDataFromColourSwatch(colourSwatch);Event.fire(document,colourSwatchClickedEvent,data);});});document.observe(colourSwatchClickedEvent,function(e){var data=e.memo;self.setCorrectValueOnSelect(data.option);});self.defaultColourSelectElement.observe('change',function(){var selectedOptionValue=this.options[this.selectedIndex].value;var correspondingColourSwatch=null;self.colourSwatches.each(function(colourSwatch){if(selectedOptionValue===colourSwatch.getAttribute('data-option')){correspondingColourSwatch=colourSwatch;self.selectColourSwatch(correspondingColourSwatch);return false;}});var data=self.extractDataFromColourSwatch(correspondingColourSwatch);self.updateImagery(data);Event.fire(document,'penheaven_journal_colour_handler:imagery_updated',data);});},selectColourSwatch:function(colourSwatch){var self=this;self.colourSwatches.each(function(colourSwatch){colourSwatch.up('li').removeClassName('selected-colour-option');});colourSwatch.up('li').addClassName('selected-colour-option');},setCorrectValueOnSelect:function(option){var self=this;self.defaultColourSelectElement.value=option;Event.simulate(self.defaultColourSelectElement,'change');},updateImagery:function(data){var self=this;self.mainImages.each(function(image){image.src=data.img;});var galleryHtml='';for(var i=0;i<data.gallery.length;i++){var thumb=data.gallery[i].thumb;var main=data.gallery[i].main;galleryHtml+='<li class="product-thumbnail"><a href="#" title="" class="additional-image"><img src="'+thumb+'" data-image="'+main+'"/></a></li>';}
if(galleryHtml){self.options.galleries.each(function(gallery){gallery.innerHTML=galleryHtml;});new window.Meanbee.ToggleImageGallery({thumbs:$$('.image-original-thumbnails .additional-image')});}},extractDataFromColourSwatch:function(colourSwatch){return{option:colourSwatch.getAttribute('data-option'),img:colourSwatch.getAttribute('data-img'),gallery:JSON.parse(colourSwatch.getAttribute('data-gallery')),element:colourSwatch};}};window.Meanbee.JournalColourHandler=JournalColourHandler;})();