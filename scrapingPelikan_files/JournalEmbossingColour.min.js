(function(){'use strict';if(!window.Meanbee){window.Meanbee={};}
var JournalEmbossingColour={initialize:function(targetElement,selectedSwatchClassName,dataAttribute,mainImageSelector,colourSwatchSelector,embossingStyleBlindElements){this.mainImageSelector=mainImageSelector;this.targetElement=targetElement;this.selectedSwatchClassName=selectedSwatchClassName;this.dataAttribute=dataAttribute;this.originalColor=null;this.colourSwatchSelector=colourSwatchSelector;this.embossingStyleBlindElements=embossingStyleBlindElements;var colourSwatches=$(this.colourSwatchSelector);var tinycolor=window.tinycolor;if(tinycolor){document.observe('penheaven:engraving_image_loaded',this.applyStyle.bind(this));this.embossingStyleBlindElements.each(function(element){element.observe('penheaven:embossing_style_changed_to_blind',this.applyStyle.bind(this));}.bind(this));}else{return false;}},calcTextColor:function(){return tinycolor.darken(this.originalColor,7).toHexString();},calcInnerShadowColor:function(){return tinycolor.darken(this.originalColor,35).toHexString();},calcOuterShadowColor:function(){return tinycolor.lighten(this.originalColor,10).toHexString();},computeFontColour:function(){var originalColorElement=document.body.select('.'+this.selectedSwatchClassName).first();if(!originalColorElement){originalColorElement=$$(this.colourSwatchSelector).first();}
if(ColorThief){var componentToHex=function(c){var hex=c.toString(16);return hex.length==1?"0"+hex:hex;}
try{var colourThief=new ColorThief();var mainImage=$$(this.mainImageSelector).first();var dominantColour=colourThief.getColor(mainImage);if(dominantColour){var r=dominantColour[0],g=dominantColour[1],b=dominantColour[2];originalColorElement.setAttribute(this.dataAttribute,"#"+componentToHex(r)+componentToHex(g)+componentToHex(b));}}catch(e){}}},applyStyle:function(){this.computeFontColour();var originalColorElement=document.body.select('.'+this.selectedSwatchClassName).first();this.originalColor=originalColorElement.readAttribute(this.dataAttribute);var color=this.calcTextColor(),outerShadow=this.calcOuterShadowColor(),innerShadow=this.calcInnerShadowColor();this.targetElement.setStyle({'textShadow':'0 2px 3px '+outerShadow+', 0 -1px 0 '+innerShadow,'color':color});}};window.Meanbee.JournalEmbossingColour=JournalEmbossingColour;})();